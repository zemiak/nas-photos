#/bin/sh

test -f /usr/libexec/java_home && export JAVA_HOME=$(/usr/libexec/java_home)
mvn -q package  || exit 3

if [ $? -eq 0 ]
then
    cp ./target/nasphotos.war ./src/main/docker/
    cd ./src/main/docker
    docker kill nasphotos-dev
    docker rm -f nasphotos-dev
    docker build --tag nasphotos-dev . || exit 4
    cd ../../..
    pwd

    if [ -d /c/Windows ]
    then
        FILE=run-dev-win.sh
        SRV=10.8.13.65
    else
        FILE=run-dev-linux.sh
        SRV=lenovo-server.local
    fi

    scp ${FILE} vasko@${SRV}:/home/vasko/
    ssh vasko@${SRV} "sh /home/vasko/${FILE}"
fi
